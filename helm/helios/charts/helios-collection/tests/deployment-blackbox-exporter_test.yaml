suite: blackbox_exporter Deployment
templates:
  - templates/deployment-blackbox-exporter.yaml
values:
  - ../values.yaml
tests:
  - it: should create a Deployment when enabled
    asserts:
      - isKind:
          of: Deployment
      - equal:
          path: metadata.name
          value: RELEASE-NAME-blackbox-exporter

  - it: should not render when disabled
    set:
      blackboxExporter:
        enabled: false
    asserts:
      - hasDocuments:
          count: 0

  - it: should use correct container image
    asserts:
      - equal:
          path: spec.template.spec.containers[0].image
          value: prom/blackbox-exporter:latest

  - it: should mount probe config volume
    asserts:
      - contains:
          path: spec.template.spec.containers[0].volumeMounts
          content:
            name: config
            mountPath: /etc/blackbox_exporter
          any: true

  - it: should expose blackbox exporter port
    asserts:
      - contains:
          path: spec.template.spec.containers[0].ports
          content:
            name: http
            containerPort: 9115
          any: true

  - it: should define config volume from ConfigMap
    asserts:
      - contains:
          path: spec.template.spec.volumes
          content:
            name: config
            configMap:
              name: RELEASE-NAME-blackbox-config
          any: true
