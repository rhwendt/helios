suite: snmp_exporter Deployment
templates:
  - templates/deployment-snmp-exporter.yaml
values:
  - ../values.yaml
tests:
  - it: should create a Deployment when enabled
    asserts:
      - isKind:
          of: Deployment
      - equal:
          path: metadata.name
          value: RELEASE-NAME-snmp-exporter

  - it: should not render when disabled
    set:
      snmpExporter:
        enabled: false
    asserts:
      - hasDocuments:
          count: 0

  - it: should use correct container image
    asserts:
      - equal:
          path: spec.template.spec.containers[0].image
          value: prom/snmp-exporter:latest

  - it: should mount SNMP modules ConfigMap
    asserts:
      - contains:
          path: spec.template.spec.containers[0].volumeMounts
          content:
            name: snmp-modules
            mountPath: /etc/snmp_exporter
          any: true

  - it: should define SNMP modules volume from ConfigMap
    asserts:
      - contains:
          path: spec.template.spec.volumes
          content:
            name: snmp-modules
            configMap:
              name: RELEASE-NAME-snmp-modules
          any: true

  - it: should expose SNMP exporter port
    asserts:
      - contains:
          path: spec.template.spec.containers[0].ports
          content:
            name: snmp
            containerPort: 9116
          any: true

  - it: should create a ServiceMonitor for snmp_exporter
    templates:
      - templates/servicemonitor-snmp-exporter.yaml
    asserts:
      - isKind:
          of: ServiceMonitor
